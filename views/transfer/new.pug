extends ../layout

block content
  .row.justify-content-center.mb-3
    .col-1.d-flex.align-items-center
      a.btn.btn-outline-secondary(href="/transfer" style="border-radius:12px;")
        i.bi.bi-arrow-left.align-middle
    .col-10.col-md-8.col-lg-6.text-center
      h2.mt-1 Send files
    .col-1
  
  if error
    .row.justify-content-center.mb-3
      .col-12.col-md-10.col-lg-8
        .alert.alert-danger.text-center= error
  
  // Recipient section
  .row.justify-content-center.mb-3
    .col-12.col-md-10.col-lg-8
      h4.font-weight-bold Recipient
      hr.mb-3(style="border-top:3px solid #000; width:100%; margin:auto")
      .d-flex.flex-column.flex-md-row.gap-1.mb-2
        input.form-control.form-control-sm(type="email" name="recipient" id="recipient" placeholder="Recipient address" list="recipients-list" autocomplete="on" required)
        datalist#recipients-list
          each recipient in knownRecipients
            option(value=recipient)
        button.btn.btn-outline-secondary.text-nowrap(type="button" onclick="/" id="recipient-btn")
            i.bi.bi-key.me-1
            | Load Recipient Key

      #recipientKeyNotFoundError.alert.alert-danger.mb-2.small.d-none
        i.bi.bi-x-circle-fill.me-1
        | Invalid recipient, unable to load and verify key

      label.mt-2.form-label(for="publicKeyHashField") Recipient Public Key Fingerprint
      .input-group.mb-2
        input.form-control.form-control-sm(type="text", id="publicKeyHashField", value=publicKeyHash, readonly, disabled)
        button.btn.btn-outline-secondary(type="button", id="copyPublicKeyHashBtn")
          i.bi.bi-clipboard

      #newRecipientInfo.alert.alert-info.mb-2.small.d-none
        i.bi.bi-info-circle-fill.me-1
        | This is the first time you share a file with this recipient.

      #newRecipientKeyWarning.alert.alert-warning.mb-2.small.d-none
        i.bi.bi-exclamation-triangle-fill.me-1
        | The public key of the recipient has changed since the last file share.

      #trustRecipientKey.input-group.mb-2.d-none
        input.form-check-input(type="checkbox" id="trustKeyCheckbox" name="trustKey")
        label.form-check-label.ms-2(for="trustKeyCheckbox") Trust Public Key of Recipient

  // File upload section
  .row.justify-content-center.mb-3
    .col-12.col-md-10.col-lg-8
      h4.font-weight-bold Files
      hr.mb-3(style="border-top:3px solid #000; width:100%; margin:auto")
      .file-upload-area.p-5.text-center.rounded(style="background-color: #f9d71c; border: 2px dashed #333; cursor: pointer;" onclick="/")
        i.bi.bi-cloud-upload.display-4.mb-3
        h5 Add file (click to browse or drag and drop)
        input(type="file" id="fileInput" name="files" multiple style="display: none;")
      
  // Subject section
  .row.justify-content-center.mb-3
    .col-12.col-md-10.col-lg-8
      input(type="hidden" id="_csrf" value=csrfToken)
      h4.font-weight-bold Subject
      hr.mb-3(style="border-top:3px solid #000; width:100%; margin:auto")
      input.form-control(type="text" name="subject" id="subject" placeholder="Transfer Subject (Filename by default)" required minLength=3 maxlength=256)

    // Send button
  .row.justify-content-center.mb-3
    .col-12.col-md-10.col-lg-8
      h4.font-weight-bold Send Transfer
      hr.mb-3(style="border-top:3px solid #000; width:100%; margin:auto")
      #sendError.alert.alert-danger.mb-2.small.d-none
        i.bi.bi-x-circle-fill.me-1
      button.btn.btn-dark.mb-3(type="submit" style="border-radius:15px; padding:10px 40px;" disabled) Send file(s)
      div.small.text-muted
        | Files will be encrypted and securely transferred to the recipient.

  script(type="module").
    import { setupNewTransfer } from '/js/transfer-new.js';
    setupNewTransfer();
